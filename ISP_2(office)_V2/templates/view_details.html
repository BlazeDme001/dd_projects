<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Details</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f7f7f7;
            margin: 0;
            padding: 0;
        }

        h2, h3 {
            color: #2c3e50;
            text-align: left;
        }

        .container {
            width: auto;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .section-container {
            flex-basis: 30%; /* Adjust the width of each section */
        }

        .info-container, .plan-container, .files-container, .prod-container, .update-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin-bottom: 10px;
        }

        form {
            margin-top: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        select, input {
            padding: 8px;
            margin-bottom: 10px;
        }

        input[type="submit"] {
            background-color: #747779;
            color: #fff;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }

        input[type="submit"]:hover {
            background-color: #474747;
        }
    </style>
</head>
<body>
    {% include 'header.html' %}
    <div class="container">
        <!-- Customer Information -->
        <div class="section-container">
            <div class="info-container">
                <h3>Customer Information</h3>
                <p>
                    <strong>Customer ID:</strong> {{ cust_data[0] }}<br>
                    <strong>Customer Name:</strong> {{ cust_data[1] }}<br>
                    <strong>Mobile:</strong> {{ cust_details_data[1] }}<br>
                    <strong>Email:</strong> {{ cust_details_data[2] }}<br>
                    <strong>Apartment Name:</strong> {{ cust_details_data[5] }}<br>
                    <strong>Tower No:</strong> {{ cust_details_data[4] }}<br>
                    <strong>Flat No:</strong> {{ cust_details_data[3] }}<br>
                    <strong>Status:</strong> {{ cust_data[5] }}<br>
                    <strong>Created Time:</strong> {{ cust_data[6] }}<br>
                </p>
            </div>
        </div>
        
        <!-- Plan Details -->
        <div class="section-container">
            <div class="plan-container">
                <h3>Current Plan Details</h3>
                {% for plan in plan_details_data %}
                    <p>
                        <strong>ISP ID:</strong> {{ plan[0] }}<br>
                        <strong>ISP Name:</strong> {{ cust_data[2] }}<br>
                        <strong>Name:</strong> {{ plan[1] }}<br>
                        <strong>Amount:</strong> {{ plan[2] }}<br>
                        <strong>Network Speed:</strong> {{ plan[3] }}<br>
                        <strong>Duration:</strong> {{ plan[4] }}<br>
                        <strong>Status:</strong> {{ plan[5] }}<br>
                        <strong>Features:</strong> {{ plan[6] }}<br>
                    </p>
                {% endfor %}
            </div>
        </div>

        <!-- Files -->
        <div class="section-container">
            <div class="files-container">
                <h3>Files</h3>
                {% if files_list %}
                <ul>
                    {% for file_name in files_list %}
                        <li><a href="{{ url_for('download_file', folder_path=folder_path, file_name=file_name) }}" target="_blank">{{ file_name }}</a></li>
                    {% endfor %}
                </ul>
                {% else %}
                <p>No files found.</p>
                {% endif %}
            </div>
        </div>

        <!-- Product Details -->
        <div class="section-container">
            <div class="prod-container">
                <h3>Product Details</h3>
                {% if not current_assigned_prod.empty %}
                    <p>
                        <strong>ID:</strong> {{ current_assigned_prod.prod_id }}<br>
                        <strong>Name:</strong> {{ current_assigned_prod.name }}<br>
                        <strong>Description:</strong> {{ current_assigned_prod.description }}<br>
                        <strong>Serial No:</strong> {{ current_assigned_prod.serial_no }}<br>
                        <strong>MAC No:</strong> {{ current_assigned_prod.mac_no }}<br>
                        <strong>Type:</strong> {{ current_assigned_prod.type }}<br>
                    </p>
                {% else %}
                    <p>No product details available.</p>
                {% endif %}
            </div>
        </div>

        <!-- Update Payment Status Form -->
        <div class="section-container">
            <div class="update-container">
                <h3>Update Status</h3>
                <form method="post" action="">
                    {% if cust_data[5] != 'Pending Product Allocation' %}
                    <label for="payment_status">Payment Status:</label>
                    <select name="payment_status" id="payment_status" required>
                        {% if cust_data[5] == 'Pending Verification - DOC' %}
                            <option value="">Select</option>
                            <option value="true" selected>Paid</option>
                            <option value="false">Not Paid</option>
                        {% elif cust_data[5] == 'Pending Verification - Payment' %}
                            <option value="">Select</option>
                            <option value="true" >Paid</option>
                            <option value="false" selected>Not Paid</option>
                        {% else %}
                            <option value="">Select</option>
                            <option value="true">Paid</option>
                            <option value="false">Not Paid</option>
                        {% endif %}
                    </select>

                    <label for="doc_status">Document Verification:</label>
                    <select name="doc_status" id="doc_status" required>
                        {% if cust_data[5] == 'Pending Verification - Payment' %}
                            <option value="">Select</option>
                            <option value="true" selected>Verified</option>
                            <option value="false">Not Verified</option>
                        {% elif cust_data[5] == 'Pending Verification - DOC' %}
                            <option value="">Select</option>
                            <option value="true" >Verified</option>
                            <option value="false" selected>Not Verified</option>
                        {% else %}
                            <option value="" selected>Select</option>
                            <option value="true">Verified</option>
                            <option value="false">Not Verified</option>
                        {% endif %}
                    </select>
                    <br>
                    <input type="submit" name="update_payment_status" value="Update Payment Status" class="btn">

                    {% elif cust_data[5] == 'Pending Product Allocation' %}
                    <label for="product_name">Product Name:</label>
                    <select name="product_name" id="product_name" required>
                        <option value="" selected>Select</option>
                        {% for product_name in uniqueProductNames %}
                            <option value="{{ product_name }}">{{ product_name }}</option>
                        {% endfor %}
                    </select>                    
                    
                    <label for="product_type">Product Type:</label>
                    <select name="product_type" id="product_type" required>
                        <option value="" selected>Select</option>
                    </select>
                    
                    <label for="mac_no">MAC No:</label>
                    <select name="mac_no" id="mac_no" required></select>
                    
                    <label for="serial_no">Serial No:</label>
                    <select name="serial_no" id="serial_no" required></select>

                    <input type="submit" name= "Allocate_Product" value="Allocate_Product" class="btn">
                    {% endif %}
                </form>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            var prodDetailsData = {{ prod_details_data|tojson|safe }};
        
            $('#product_name').change(function () {
                var selectedProductName = $(this).val();
                var filteredData = prodDetailsData.filter(item => item.name === selectedProductName);
        
                if (filteredData.length > 0) {
                    var types = Array.from(new Set(filteredData.map(item => item.type)));
                    updateDropdownOptions('#product_type', types);
                } else {
                    $('#product_type').empty();
                    $('#mac_no').empty();
                    $('#serial_no').empty();
                }
            });
        
            $('#product_type').change(function () {
                var selectedProductType = $(this).val();
                var filteredData = prodDetailsData.filter(item => item.type === selectedProductType);
        
                if (filteredData.length > 0) {
                    var macNos = Array.from(new Set(filteredData.map(item => item.mac_no)));
                    var serialNos = Array.from(new Set(filteredData.map(item => item.serial_no)));
                    updateDropdownOptions('#mac_no', macNos);
                    updateDropdownOptions('#serial_no', serialNos);
                } else {
                    $('#mac_no').empty();
                    $('#serial_no').empty();
                }
            });
        
            // Function to update dropdown options
            function updateDropdownOptions(selectElement, data) {
                $(selectElement).empty();
                data.forEach(function (item) {
                    $(selectElement).append($('<option>', {
                        value: item,
                        text: item
                    }));
                });
            }
        
            // Logic to update corresponding values
            $('#mac_no').change(function () {
                var selectedMacNo = $(this).val();
                var filteredData = prodDetailsData.filter(item => item.mac_no === selectedMacNo);
                if (filteredData.length > 0) {
                    var serialNo = filteredData[0].serial_no;
                    $('#serial_no').val(serialNo);
                }
            });
        
            $('#serial_no').change(function () {
                var selectedSerialNo = $(this).val();
                var filteredData = prodDetailsData.filter(item => item.serial_no === selectedSerialNo);
                if (filteredData.length > 0) {
                    var macNo = filteredData[0].mac_no;
                    $('#mac_no').val(macNo);
                }
            });
        });
        
    </script>
    
    
</body>
</html>
